@model F1WebSite.ViewModels.DriversViewModel
@{
    ViewData["Title"] = "F1 races";
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"]</title>
    <link rel="stylesheet" href="~/css/styleRace.css">
    <link rel="stylesheet" href="~/css/shared.css">
</head>
<body>
    <div class="driver-title">
        <h1>F1 Races</h1>
        <button id="addRaceButton" class="addButton" onclick="togglePopup()">+</button>@* opens a pop-up with a form that asks the driver info *@

        <div id="myPopup" class="popup">
            <div class="popup-content">
                <h2>Add a new race</h2>
                <div class="form">
                    <label for="name">Race name:</label>
                    <input type="text" id="name" name="name" required />

                    <label for="date">Date (YYYY-MM-DD):</label>
                    <input type="text" id="date" name="date" required pattern="\d{4}-\d{2}-\d{2}" placeholder="YYYY-MM-DD" />
                    <small>Format: YYYY-MM-DD</small>

                    <label for="laps">Number of laps:</label>
                    <input type="text" id="laps" name="laps" required />

                    <label for="track">track:</label>
                    <select id="track" name="track" required>
                        <option value="" disabled selected>Select a track</option>
                        @foreach (var track in Model.Tracks)
                        {
                            <option value="@track.trackId">@track.name</option>
                        }
                    </select>
                </div>
                <button type="button" onclick="submitDriver()">Submit</button>
                <button type="button" onclick="closePopup()">Cancel</button>
            </div>
        </div>

        <div class="overlay" onclick="closePopup()"></div>


    </div>
    <div class="race-card-container">
        @foreach (var race in Model.Races)
        {
            <a class="race-card" style="--race-border-color: #FF4500;">
                <div class="race-header">
                    <h1>@race.name</h1>
                </div>

                <div class="race-details">
                    @{
                        DateTime raceDate;
                        if (DateTime.TryParse(race.date, out raceDate))
                        {
                            <p><strong>Date:</strong> @raceDate.ToString("yyyy-MM-dd")</p>
                        }
                        else
                        {
                            <p><strong>Date:</strong> Invalid date</p>
                        }
                    }
                    <p><strong>Laps:</strong> @race.laps</p>
                    @{
                        var currentTrack = Model.Tracks.FirstOrDefault(t => t.trackId == race.trackId);
                    }
                    <p><strong>Track:</strong> @currentTrack.name</p> 
                </div> 
            </a>

        }
    </div> 

    <script>
        function togglePopup() {
            document.getElementById("myPopup").style.display = "block";
            document.querySelector(".overlay").style.display = "block";
        }

                function submitDriver() {
            var race = {
                name: document.getElementById('name').value,
                laps: document.getElementById('laps').value,
                date: document.getElementById('date').value,
                trackId: document.getElementById('track').value // Fix: Use .value to get the selected track ID
            };

            // Log all race details for debugging
            console.log("Race Details:", race);

            // Validation to ensure all fields are filled
            if (!race.name || !race.laps || !race.date || !race.trackId) {
                alert("All fields are required!");
                return;
            }

            // Construct the URL to send data to the server
            var url = '@Url.Action("AddRace", "Home")' +
                      '?name=' + encodeURIComponent(race.name) +
                      '&laps=' + encodeURIComponent(race.laps) +
                      '&date=' + encodeURIComponent(race.date) +
                      '&trackId=' + encodeURIComponent(race.trackId);

            console.log("Redirecting to:", url); // Log the URL for debugging

            // Redirect to the server endpoint
            window.location.href = url;
        }


        function closePopup() {
            document.getElementById("myPopup").style.display = "none";
            document.querySelector(".overlay").style.display = "none";
        }
    </script>
</body>